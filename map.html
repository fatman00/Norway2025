<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Norway Fall 2025</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        body {
            background-color: linen;
        }

        h1 {
            color: maroon;
            margin-left: 40px;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>

</head>

<body>
    <div id="map"></div>
    <script>
        // Make the map on the screen
        //var map = L.map('map').setView([51.505, -0.09], 13);
        //Center on Norway
        var map = L.map('map').setView([60.473465, 7.712402], 7);

        // Find the right tiles here:
        // https://leaflet-extras.github.io/leaflet-providers/preview/index.html

        //Load tiles
        var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        });

        var OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            maxZoom: 17,
            attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
        });

        // https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/10/291/533.jpg
        var arcgis = L.tileLayer('https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}.jpg', {
            maxZoom: 13,
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri',
            opacity: 0.25
        });

        // Old demo code
        /*
        var marker = L.marker([51.5, -0.09]).addTo(map);

        var circle = L.circle([51.508, -0.11], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 500
        }).addTo(map);

        var polygon = L.polygon([
            [51.509, -0.08],
            [51.503, -0.06],
            [51.51, -0.047]
        ]).addTo(map);

        marker.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();
        circle.bindPopup("I am a circle.");
        polygon.bindPopup("I am a polygon.");

        var popup = L.popup()
            .setLatLng([51.513, -0.09])
            .setContent("I am a standalone popup.")
            .openOn(map);
        */

        function onMapClick(e) {
            popup
                .setLatLng(e.latlng)
                .setContent("You clicked the map at " + e.latlng.toString())
                .openOn(map);
        }

        //map.on('click', onMapClick);

        // https://leafletjs.com/examples/mobile/
        // https://www.youtube.com/watch?v=NyjMmNCtKf4
        // https://gis.stackexchange.com/questions/383909/leaflet-locate-current-location
        function onLocationFound(e) {
            var radius = e.accuracy;
            L.circle(e.latlng, radius).addTo(map);
        }
        map.on('locationfound', onLocationFound);

        var LeafIcon = L.Icon.extend({
            options: {
                iconSize: [20, 20], // size of the icon
                iconAnchor: [10, 20], // point of the icon which will correspond to marker's location
                popupAnchor: [0, 0] // point from which the popup should open relative to the iconAnchor
            }
        });
        var iconBiltema = new LeafIcon({ iconUrl: 'biltema.png' }),
            iconElkjop = new LeafIcon({ iconUrl: 'elkjop.png' }),
            iconEon = new LeafIcon({ iconUrl: 'eon.png' }),
            iconWater = new LeafIcon({ iconUrl: 'drinking-water.png', iconSize: [16, 16] }),
            iconToilet = new LeafIcon({ iconUrl: 'toilet.png', iconSize: [16, 16] }),
            iconTaxi = new LeafIcon({ iconUrl: 'taxi.jpg', iconSize: [70, 70] }),
            iconTrack = new LeafIcon({ iconUrl: 'track.png', iconSize: [20, 20], iconAnchor: [10, 20] }),
            iconGps = new LeafIcon({ iconUrl: 'gps.png', iconSize: [20, 20], iconAnchor: [10, 20] }),
            iconFlag = new LeafIcon({ iconUrl: 'flag.png', iconSize: [20, 20], iconAnchor: [0, 20] }),
            iconPin = new LeafIcon({ iconUrl: 'pinGreen.png', iconSize: [20, 20], iconAnchor: [0, 20] }),
            iconFoss = new LeafIcon({ iconUrl: 'waterfall.png', iconSize: [30, 30], iconAnchor: [0, 30], popupAnchor: [15, -30] }),
            iconTesla = new LeafIcon({ iconUrl: 'tesla.png' });

        L.marker([51.5, -0.09], { icon: iconElkjop }).addTo(map).bindPopup("This is a Elkjop ICON");



        function onEachFeatureTesla(feature, layer) {
            // does this feature have a property named popupContent?
            if (feature.properties && feature.properties.name) {
                layer.bindPopup(feature.properties.name);
            }
            // https://gis.stackexchange.com/questions/153381/changing-marker-icon-from-oneachfeature-instead-of-pointtolayer-using-leaflet
            layer.setIcon(iconTesla)
        }

        var teslaLayer = L.geoJSON(false, { onEachFeature: onEachFeatureTesla });



        function onEachFeatureEon(feature, layer) {
            // does this feature have a property named popupContent?
            if (feature.properties && feature.properties.name) {
                layer.bindPopup(feature.properties.name);
            }
            // https://gis.stackexchange.com/questions/153381/changing-marker-icon-from-oneachfeature-instead-of-pointtolayer-using-leaflet
            layer.setIcon(iconEon)
        }

        var eonLayer = L.geoJSON(false, { onEachFeature: onEachFeatureEon });


        function onEachFeatureWater(feature, layer) {
            // does this feature have a property named popupContent?
            if (feature.properties && feature.properties.name) {
                layer.bindPopup(feature.properties.name);
            }
            // https://gis.stackexchange.com/questions/153381/changing-marker-icon-from-oneachfeature-instead-of-pointtolayer-using-leaflet
            layer.setIcon(iconWater)
        }

        var waterLayer = L.geoJSON(false, { onEachFeature: onEachFeatureWater });

        function onEachFeatureToilet(feature, layer) {
            // does this feature have a property named popupContent?
            if (feature.properties && feature.properties.name) {
                layer.bindPopup(feature.properties.name);
            }
            // https://gis.stackexchange.com/questions/153381/changing-marker-icon-from-oneachfeature-instead-of-pointtolayer-using-leaflet
            layer.setIcon(iconToilet)
        }

        function onEachFeatureFoss(feature, layer) {
            // does this feature have a property named popupContent?
            if (feature.properties && feature.properties.name) {
                layer.bindPopup(feature.properties.name);
            }
            // https://gis.stackexchange.com/questions/153381/changing-marker-icon-from-oneachfeature-instead-of-pointtolayer-using-leaflet
            layer.setIcon(iconFoss)
        }
        // feature.properties.desc ? `<strong>${feature.properties.name}</strong><br>${feature.properties.desc}` : feature.properties.name
        function onEachFeaturePOI(feature, layer) {
            // does this feature have a property named popupContent?
            if (feature.properties && feature.properties.name) {
                layer.bindPopup(feature.properties.desc ? '<strong>${feature.properties.name}</strong><br>${feature.properties.desc}' : feature.properties.name);
            }
            // https://gis.stackexchange.com/questions/153381/changing-marker-icon-from-oneachfeature-instead-of-pointtolayer-using-leaflet
            layer.setIcon(iconPin)
        }

        function onEachFeatureVeg(feature, layer) {
            // does this feature have a property named popupContent?
            console.log(feature.properties)
            if (feature.properties && feature.properties.name && feature.properties.closures) {
                layer.bindPopup("<b>" + feature.properties.name + "</b><br />" + feature.properties.closures);
            }
            layer.setStyle({ "weight": 6, "stroke-linecap": "round" })
        }

        function onEachFeatureDrive(feature, layer) {
            // does this feature have a property named popupContent?
            console.log(feature.properties)
            if (feature.properties && feature.properties.name) {
                layer.bindPopup("<b>" + feature.properties.name + "</b>");
            }
        }

        function onEachFeatureDay(feature, layer) {
            // does this feature have a property named popupContent?
            console.log(feature.properties)
            if (feature.properties && feature.properties.name) {
                layer.bindPopup("<b>" + feature.properties.name + "</b>");
            }
        }

        var geojsonMarkerOptions = {
            radius: 5,
            fillColor: "white",
            color: "gray",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };

        function pointOI(feature, latlng) {
            if (feature.properties && feature.properties.type == "end") {
                return L.marker(latlng, { icon: iconFlag });
            }
            //return L.circleMarker(latlng, geojsonMarkerOptions);
            return L.marker(latlng, { icon: iconTrack });
        }

        //var toiletLayer = L.geoJSON(false, { onEachFeature: onEachFeatureToilet }).addTo(map);
        var toiletLayer = L.geoJSON(false, { onEachFeature: onEachFeatureToilet });

        var fossLayer = L.geoJSON(false, { onEachFeature: onEachFeatureFoss });

        var pinLayer = L.geoJSON(false, { onEachFeature: onEachFeaturePOI });



        // Color on the roads: https://leafletjs.com/examples/choropleth/
        var atlantLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var geirangerLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var hardangerLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var jarenLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var rondaneLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var ryfylkeLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var sognefjelletLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var varaldresflyLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var viddaLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var gaular1Layer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var gaular2Layer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });
        var aurlandLayer = L.geoJSON(false, { onEachFeature: onEachFeatureVeg });

        var spring25Layer = L.geoJSON(false, { onEachFeature: onEachFeatureDrive, style: { color: "#2D9966", "dashArray": "5,10" } }); // #FE9A37
        var fall24Layer = L.geoJSON(false, { onEachFeature: onEachFeatureDrive, style: { color: "#FE9A37", "dashArray": "5,10" } }); // #FE9A37
        // https://stackoverflow.com/questions/47229723/how-to-style-path-in-leaflet
        var day1Layer = L.geoJSON(false, { onEachFeature: onEachFeatureDay, pointToLayer: pointOI, style: { color: "#496DB6" } }); // #8AA2D0
        var day2Layer = L.geoJSON(false, { onEachFeature: onEachFeatureDay, pointToLayer: pointOI, style: { color: "#496DB6" } }); // #7792C9
        var day3Layer = L.geoJSON(false, { onEachFeature: onEachFeatureDay, pointToLayer: pointOI, style: { color: "#496DB6" } }); // #496DB6
        var day4Layer = L.geoJSON(false, { onEachFeature: onEachFeatureDay, pointToLayer: pointOI, style: { color: "#496DB6" } }); // #3C5A96
        var day5Layer = L.geoJSON(false, { onEachFeature: onEachFeatureDay, pointToLayer: pointOI, style: { color: "#496DB6" } }); // #2F4675
        var day6Layer = L.geoJSON(false, { onEachFeature: onEachFeatureDay, pointToLayer: pointOI, style: { color: "#496DB6" } }); // #213254
        //var day6omLayer = L.geoJSON(false, { onEachFeature: onEachFeatureDay, pointToLayer: pointOI, style: { color: "#496DB6", "dashArray": "5,10" } }); // #213254
        //var day7Layer = L.geoJSON(false, { onEachFeature: onEachFeatureDay, pointToLayer: pointOI, style: { color: "#496DB6" } }); // #141F33


        // https://stackoverflow.com/questions/55966676/how-can-i-assign-the-contents-of-a-geojson-file-to-a-variable-in-javascript
        // Take a look at the async setup
        /*function fetchJSON(url) {
            return fetch(url)
                .then(function (response) {
                    return response.json();
                });
        }
        */


        function fetchJSON(url) {
            return fetch(url)
                .then(response => response.json())
                .catch((error) => {
                    console.log(error);
                });
        }
        fetchJSON('https://fatman00.github.io/Norway2025/Tesla_NO_SC.geojson')
            .then((data) => {
                teslaLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/eon.geojson')
            .then((data) => {
                eonLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/drinking_water.geojson')
            .then((data) => {
                waterLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/free_toilets.geojson')
            .then((data) => {
                toiletLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/aifoss.geojson')
            .then((data) => {
                fossLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/atlanvegen.geojson')
            .then((data) => {
                atlantLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/geiranger.geojson')
            .then((data) => {
                geirangerLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/hardanger.geojson')
            .then((data) => {
                hardangerLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/jaren.geojson')
            .then((data) => {
                jarenLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/rondane.geojson')
            .then((data) => {
                rondaneLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/ryfylke.geojson')
            .then((data) => {
                ryfylkeLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/sognefjellet.geojson')
            .then((data) => {
                sognefjelletLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/varaldresfly.geojson')
            .then((data) => {
                varaldresflyLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/vidda.geojson')
            .then((data) => {
                viddaLayer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/gaularfjellet1.geojson')
            .then((data) => {
                gaular1Layer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/gaularfjellet2.geojson')
            .then((data) => {
                gaular2Layer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/aurland.geojson')
            .then((data) => {
                aurlandLayer.addData(data);
            });
        var baseUrl = 'https://fatman00.github.io/Norway2025/';
        var pinData = ['atlanterhavsvegenpoi.geojson', 'gaularfjelletpoi.geojson','hardangerpoi.geojson','rondanepoi.geojson','aurlandfjelletpoi.geojson','geirangerpoi.geojson','hardangerviddapoi.geojson','ryfylkepoi.geojson', 'privatepoi.geojson'];

        pinData.forEach(addPins);

        function addPins(url) {
            console.log("adding:"+baseUrl+url);
            fetchJSON(baseUrl+url)
                .then((data) => {
                    pinLayer.addData(data);
                });
        }
        fetchJSON('https://fatman00.github.io/Norway2025/data-spring_2025.geojson')
            .then((data) => {
                spring25Layer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/data-fall_2024.geojson')
            .then((data) => {
                fall24Layer.addData(data);
            });

        // Single day data for fall 2025 trip
        fetchJSON('https://fatman00.github.io/Norway2025/day1.geojson')
            .then((data) => {
                day1Layer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/day2.geojson')
            .then((data) => {
                day2Layer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/day3.geojson')
            .then((data) => {
                day3Layer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/day4.geojson')
            .then((data) => {
                day4Layer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/day5.geojson')
            .then((data) => {
                day5Layer.addData(data);
            });

        fetchJSON('https://fatman00.github.io/Norway2025/day6.geojson')
            .then((data) => {
                day6Layer.addData(data);
            });


        var osmWithRelief = L.layerGroup([osm, arcgis]);

        var baseMaps = {
            "OpenStreetMap": osm,
            "OSM with relief": osmWithRelief,
            "ESRI World Imagery": Esri_WorldImagery,
            "OpenTopoMap": OpenTopoMap
        };



        var turistVegerGroup = L.layerGroup([atlantLayer, geirangerLayer, hardangerLayer, jarenLayer, rondaneLayer, ryfylkeLayer, sognefjelletLayer, varaldresflyLayer, viddaLayer, gaular1Layer, gaular2Layer, aurlandLayer]);
        var fall25Group = L.layerGroup([day1Layer, day2Layer, day3Layer, day4Layer, day5Layer, day6Layer]);
        // No need for groups here
        /*
        var teslaGroup = L.layerGroup([teslaLayer])
        var eonGroup = L.layerGroup([eonLayer])
        var toiletsGroup = L.layerGroup([toiletLayer])
        var waterGroup = L.layerGroup([waterLayer])
        var spring25Group = L.layerGroup([spring25Layer]);
        var fall24Group = L.layerGroup([fall24Layer]);
        */


        var overlayMaps = {
            "Tesla": teslaLayer,
            "E.ON": eonLayer,
            "Drinking Water": waterLayer,
            "Toilets": toiletLayer,
            "Foss": fossLayer,
            "National Turist Veger": turistVegerGroup,
            "Turist Veger Vistas": pinLayer,
            "Fall 2024": fall24Layer,
            "Spring 2025": spring25Layer,
            "Fall 2025": fall25Group
        };

        var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
        teslaLayer.addTo(map)
        eonLayer.addTo(map)
        turistVegerGroup.addTo(map)
        fall25Group.addTo(map)
        //spring25Layer.addTo(map)
        //fall24Layer.addTo(map)
        //toiletsGroup.addTo(map)

        //myLayer.addData(tesla);
        // https://stackoverflow.com/questions/34384905/leaflet-how-to-toggle-all-layers-either-off-or-on-at-once
        //toiletGroup.clearLayers();


    </script>

</body>

</html>